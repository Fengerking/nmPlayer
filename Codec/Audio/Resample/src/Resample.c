//#include "mem_align.h"
#include "voResample.h"
#include "resample.h"

const int FilterLength[12] = {31, 15, 7, 7, 63, 31, 15, 7, 127, 63, 31, 15};

const int sampRateTab[12] = {
    96000, 88200, 64000, 48000, 44100, 32000, 
	24000, 22050, 16000, 12000, 11025,  8000
};


//	for(i = 0; i < 1024; i++)
//	{
//		angle = i * M_PI / 1024;
//		tmpValue1 = sin(angle) * (1 << 30) + 0.5;
//	}
const int SinTab[1024] = {
	0x00000000, 0x003243f1, 0x006487c4, 0x0096cb58, 0x00c90e90, 0x00fb514b, 0x012d936c, 0x015fd4d2, 
	0x0192155f, 0x01c454f5, 0x01f69373, 0x0228d0bb, 0x025b0caf, 0x028d472e, 0x02bf801a, 0x02f1b755, 
	0x0323ecbe, 0x03562038, 0x038851a2, 0x03ba80df, 0x03ecadcf, 0x041ed854, 0x0451004d, 0x0483259d, 
	0x04b54825, 0x04e767c5, 0x0519845e, 0x054b9dd3, 0x057db403, 0x05afc6d0, 0x05e1d61b, 0x0613e1c5, 
	0x0645e9af, 0x0677edbb, 0x06a9edc9, 0x06dbe9bb, 0x070de172, 0x073fd4cf, 0x0771c3b3, 0x07a3adff, 
	0x07d59396, 0x08077457, 0x08395024, 0x086b26de, 0x089cf867, 0x08cec4a0, 0x09008b6a, 0x09324ca7, 
	0x09640837, 0x0995bdfd, 0x09c76dd8, 0x09f917ac, 0x0a2abb59, 0x0a5c58c0, 0x0a8defc3, 0x0abf8043, 
	0x0af10a22, 0x0b228d42, 0x0b540982, 0x0b857ec7, 0x0bb6ecef, 0x0be853de, 0x0c19b374, 0x0c4b0b94, 
	0x0c7c5c1e, 0x0cada4f5, 0x0cdee5f9, 0x0d101f0e, 0x0d415013, 0x0d7278eb, 0x0da39978, 0x0dd4b19a, 
	0x0e05c135, 0x0e36c82a, 0x0e67c65a, 0x0e98bba7, 0x0ec9a7f3, 0x0efa8b20, 0x0f2b650f, 0x0f5c35a3, 
	0x0f8cfcbe, 0x0fbdba40, 0x0fee6e0d, 0x101f1807, 0x104fb80e, 0x10804e06, 0x10b0d9d0, 0x10e15b4e, 
	0x1111d263, 0x11423ef0, 0x1172a0d7, 0x11a2f7fc, 0x11d3443f, 0x12038584, 0x1233bbac, 0x1263e699, 
	0x1294062f, 0x12c41a4f, 0x12f422db, 0x13241fb6, 0x135410c3, 0x1383f5e3, 0x13b3cefa, 0x13e39be9, 
	0x14135c94, 0x144310dd, 0x1472b8a5, 0x14a253d1, 0x14d1e242, 0x150163dc, 0x1530d881, 0x15604013, 
	0x158f9a76, 0x15bee78c, 0x15ee2738, 0x161d595d, 0x164c7ddd, 0x167b949d, 0x16aa9d7e, 0x16d99864, 
	0x17088531, 0x173763c9, 0x1766340f, 0x1794f5e6, 0x17c3a931, 0x17f24dd3, 0x1820e3b0, 0x184f6aab, 
	0x187de2a7, 0x18ac4b87, 0x18daa52f, 0x1908ef82, 0x19372a64, 0x196555b8, 0x19937161, 0x19c17d44, 
	0x19ef7944, 0x1a1d6544, 0x1a4b4128, 0x1a790cd4, 0x1aa6c82b, 0x1ad47312, 0x1b020d6c, 0x1b2f971e, 
	0x1b5d100a, 0x1b8a7815, 0x1bb7cf23, 0x1be51518, 0x1c1249d8, 0x1c3f6d47, 0x1c6c7f4a, 0x1c997fc4, 
	0x1cc66e99, 0x1cf34baf, 0x1d2016e9, 0x1d4cd02c, 0x1d79775c, 0x1da60c5d, 0x1dd28f15, 0x1dfeff67, 
	0x1e2b5d38, 0x1e57a86d, 0x1e83e0eb, 0x1eb00696, 0x1edc1953, 0x1f081907, 0x1f340596, 0x1f5fdee6, 
	0x1f8ba4dc, 0x1fb7575c, 0x1fe2f64c, 0x200e8190, 0x2039f90f, 0x20655cac, 0x2090ac4d, 0x20bbe7d8, 
	0x20e70f32, 0x21122240, 0x213d20e8, 0x21680b0f, 0x2192e09b, 0x21bda171, 0x21e84d76, 0x2212e492, 
	0x223d66a8, 0x2267d3a0, 0x22922b5e, 0x22bc6dca, 0x22e69ac8, 0x2310b23e, 0x233ab414, 0x2364a02e, 
	0x238e7673, 0x23b836ca, 0x23e1e117, 0x240b7543, 0x2434f332, 0x245e5acc, 0x2487abf7, 0x24b0e699, 
	0x24da0a9a, 0x250317df, 0x252c0e4f, 0x2554edd1, 0x257db64c, 0x25a667a7, 0x25cf01c8, 0x25f78497, 
	0x261feffa, 0x264843d9, 0x2670801a, 0x2698a4a6, 0x26c0b162, 0x26e8a637, 0x2710830c, 0x273847c8, 
	0x275ff452, 0x27878893, 0x27af0472, 0x27d667d5, 0x27fdb2a7, 0x2824e4cc, 0x284bfe2f, 0x2872feb6, 
	0x2899e64a, 0x28c0b4d2, 0x28e76a37, 0x290e0661, 0x29348937, 0x295af2a3, 0x2981428c, 0x29a778db, 
	0x29cd9578, 0x29f3984c, 0x2a19813f, 0x2a3f503a, 0x2a650525, 0x2a8a9fea, 0x2ab02071, 0x2ad586a3, 
	0x2afad269, 0x2b2003ac, 0x2b451a55, 0x2b6a164d, 0x2b8ef77d, 0x2bb3bdce, 0x2bd8692b, 0x2bfcf97c, 
	0x2c216eaa, 0x2c45c8a0, 0x2c6a0746, 0x2c8e2a87, 0x2cb2324c, 0x2cd61e7f, 0x2cf9ef09, 0x2d1da3d5, 
	0x2d413ccd, 0x2d64b9da, 0x2d881ae8, 0x2dab5fdf, 0x2dce88aa, 0x2df19534, 0x2e148566, 0x2e37592c, 
	0x2e5a1070, 0x2e7cab1c, 0x2e9f291b, 0x2ec18a58, 0x2ee3cebe, 0x2f05f637, 0x2f2800af, 0x2f49ee0f, 
	0x2f6bbe45, 0x2f8d713a, 0x2faf06da, 0x2fd07f0f, 0x2ff1d9c7, 0x301316eb, 0x30343667, 0x30553828, 
	0x30761c18, 0x3096e223, 0x30b78a36, 0x30d8143b, 0x30f8801f, 0x3118cdcf, 0x3138fd35, 0x31590e3e, 
	0x317900d6, 0x3198d4ea, 0x31b88a66, 0x31d82137, 0x31f79948, 0x3216f287, 0x32362ce0, 0x32554840, 
	0x32744493, 0x329321c7, 0x32b1dfc9, 0x32d07e85, 0x32eefdea, 0x330d5de3, 0x332b9e5e, 0x3349bf48, 
	0x3367c090, 0x3385a222, 0x33a363ec, 0x33c105db, 0x33de87de, 0x33fbe9e2, 0x34192bd5, 0x34364da6, 
	0x34534f41, 0x34703095, 0x348cf190, 0x34a99221, 0x34c61236, 0x34e271bd, 0x34feb0a5, 0x351acedd, 
	0x3536cc52, 0x3552a8f4, 0x356e64b2, 0x3589ff7a, 0x35a5793c, 0x35c0d1e7, 0x35dc0968, 0x35f71fb1, 
	0x361214b0, 0x362ce855, 0x36479a8e, 0x36622b4c, 0x367c9a7e, 0x3696e814, 0x36b113fd, 0x36cb1e2a, 
	0x36e5068a, 0x36fecd0e, 0x371871a5, 0x3731f440, 0x374b54ce, 0x37649341, 0x377daf89, 0x3796a996, 
	0x37af8159, 0x37c836c2, 0x37e0c9c3, 0x37f93a4b, 0x3811884d, 0x3829b3b9, 0x3841bc7f, 0x3859a292, 
	0x387165e3, 0x38890663, 0x38a08402, 0x38b7deb4, 0x38cf1669, 0x38e62b13, 0x38fd1ca4, 0x3913eb0e, 
	0x392a9642, 0x39411e33, 0x395782d3, 0x396dc414, 0x3983e1e8, 0x3999dc42, 0x39afb313, 0x39c5664f, 
	0x39daf5e8, 0x39f061d2, 0x3a05a9fd, 0x3a1ace5f, 0x3a2fcee8, 0x3a44ab8e, 0x3a596442, 0x3a6df8f8, 
	0x3a8269a3, 0x3a96b636, 0x3aaadea6, 0x3abee2e5, 0x3ad2c2e8, 0x3ae67ea1, 0x3afa1605, 0x3b0d8909, 
	0x3b20d79e, 0x3b3401bb, 0x3b470753, 0x3b59e85a, 0x3b6ca4c4, 0x3b7f3c87, 0x3b91af97, 0x3ba3fde7, 
	0x3bb6276e, 0x3bc82c1f, 0x3bda0bf0, 0x3bebc6d5, 0x3bfd5cc4, 0x3c0ecdb2, 0x3c201994, 0x3c314060, 
	0x3c42420a, 0x3c531e88, 0x3c63d5d1, 0x3c7467d9, 0x3c84d496, 0x3c951bff, 0x3ca53e09, 0x3cb53aaa, 
	0x3cc511d9, 0x3cd4c38b, 0x3ce44fb7, 0x3cf3b653, 0x3d02f757, 0x3d1212b7, 0x3d21086c, 0x3d2fd86c, 
	0x3d3e82ae, 0x3d4d0728, 0x3d5b65d2, 0x3d699ea3, 0x3d77b192, 0x3d859e96, 0x3d9365a8, 0x3da106bd, 
	0x3dae81cf, 0x3dbbd6d4, 0x3dc905c5, 0x3dd60e99, 0x3de2f148, 0x3defadca, 0x3dfc4418, 0x3e08b42a, 
	0x3e14fdf7, 0x3e212179, 0x3e2d1ea8, 0x3e38f57c, 0x3e44a5ef, 0x3e502ff9, 0x3e5b9392, 0x3e66d0b4, 
	0x3e71e759, 0x3e7cd778, 0x3e87a10c, 0x3e92440d, 0x3e9cc076, 0x3ea7163f, 0x3eb14563, 0x3ebb4ddb, 
	0x3ec52fa0, 0x3eceeaad, 0x3ed87efc, 0x3ee1ec87, 0x3eeb3347, 0x3ef45338, 0x3efd4c54, 0x3f061e95, 
	0x3f0ec9f5, 0x3f174e70, 0x3f1fabff, 0x3f27e29f, 0x3f2ff24a, 0x3f37dafa, 0x3f3f9cab, 0x3f473759, 
	0x3f4eaafe, 0x3f55f796, 0x3f5d1d1d, 0x3f641b8d, 0x3f6af2e3, 0x3f71a31b, 0x3f782c30, 0x3f7e8e1e, 
	0x3f84c8e2, 0x3f8adc77, 0x3f90c8da, 0x3f968e07, 0x3f9c2bfb, 0x3fa1a2b2, 0x3fa6f228, 0x3fac1a5b, 
	0x3fb11b48, 0x3fb5f4ea, 0x3fbaa740, 0x3fbf3246, 0x3fc395f9, 0x3fc7d258, 0x3fcbe75e, 0x3fcfd50b, 
	0x3fd39b5a, 0x3fd73a4a, 0x3fdab1d9, 0x3fde0205, 0x3fe12acb, 0x3fe42c2a, 0x3fe7061f, 0x3fe9b8a9, 
	0x3fec43c7, 0x3feea776, 0x3ff0e3b6, 0x3ff2f884, 0x3ff4e5e0, 0x3ff6abc8, 0x3ff84a3c, 0x3ff9c13a, 
	0x3ffb10c1, 0x3ffc38d1, 0x3ffd3969, 0x3ffe1288, 0x3ffec42d, 0x3fff4e59, 0x3fffb10b, 0x3fffec43, 
	0x40000000, 0x3fffec43, 0x3fffb10b, 0x3fff4e59, 0x3ffec42d, 0x3ffe1288, 0x3ffd3969, 0x3ffc38d1, 
	0x3ffb10c1, 0x3ff9c13a, 0x3ff84a3c, 0x3ff6abc8, 0x3ff4e5e0, 0x3ff2f884, 0x3ff0e3b6, 0x3feea776, 
	0x3fec43c7, 0x3fe9b8a9, 0x3fe7061f, 0x3fe42c2a, 0x3fe12acb, 0x3fde0205, 0x3fdab1d9, 0x3fd73a4a, 
	0x3fd39b5a, 0x3fcfd50b, 0x3fcbe75e, 0x3fc7d258, 0x3fc395f9, 0x3fbf3246, 0x3fbaa740, 0x3fb5f4ea, 
	0x3fb11b48, 0x3fac1a5b, 0x3fa6f228, 0x3fa1a2b2, 0x3f9c2bfb, 0x3f968e07, 0x3f90c8da, 0x3f8adc77, 
	0x3f84c8e2, 0x3f7e8e1e, 0x3f782c30, 0x3f71a31b, 0x3f6af2e3, 0x3f641b8d, 0x3f5d1d1d, 0x3f55f796, 
	0x3f4eaafe, 0x3f473759, 0x3f3f9cab, 0x3f37dafa, 0x3f2ff24a, 0x3f27e29f, 0x3f1fabff, 0x3f174e70, 
	0x3f0ec9f5, 0x3f061e95, 0x3efd4c54, 0x3ef45338, 0x3eeb3347, 0x3ee1ec87, 0x3ed87efc, 0x3eceeaad, 
	0x3ec52fa0, 0x3ebb4ddb, 0x3eb14563, 0x3ea7163f, 0x3e9cc076, 0x3e92440d, 0x3e87a10c, 0x3e7cd778, 
	0x3e71e759, 0x3e66d0b4, 0x3e5b9392, 0x3e502ff9, 0x3e44a5ef, 0x3e38f57c, 0x3e2d1ea8, 0x3e212179, 
	0x3e14fdf7, 0x3e08b42a, 0x3dfc4418, 0x3defadca, 0x3de2f148, 0x3dd60e99, 0x3dc905c5, 0x3dbbd6d4, 
	0x3dae81cf, 0x3da106bd, 0x3d9365a8, 0x3d859e96, 0x3d77b192, 0x3d699ea3, 0x3d5b65d2, 0x3d4d0728, 
	0x3d3e82ae, 0x3d2fd86c, 0x3d21086c, 0x3d1212b7, 0x3d02f757, 0x3cf3b653, 0x3ce44fb7, 0x3cd4c38b, 
	0x3cc511d9, 0x3cb53aaa, 0x3ca53e09, 0x3c951bff, 0x3c84d496, 0x3c7467d9, 0x3c63d5d1, 0x3c531e88, 
	0x3c42420a, 0x3c314060, 0x3c201994, 0x3c0ecdb2, 0x3bfd5cc4, 0x3bebc6d5, 0x3bda0bf0, 0x3bc82c1f, 
	0x3bb6276e, 0x3ba3fde7, 0x3b91af97, 0x3b7f3c87, 0x3b6ca4c4, 0x3b59e85a, 0x3b470753, 0x3b3401bb, 
	0x3b20d79e, 0x3b0d8909, 0x3afa1605, 0x3ae67ea1, 0x3ad2c2e8, 0x3abee2e5, 0x3aaadea6, 0x3a96b636, 
	0x3a8269a3, 0x3a6df8f8, 0x3a596442, 0x3a44ab8e, 0x3a2fcee8, 0x3a1ace5f, 0x3a05a9fd, 0x39f061d2, 
	0x39daf5e8, 0x39c5664f, 0x39afb313, 0x3999dc42, 0x3983e1e8, 0x396dc414, 0x395782d3, 0x39411e33, 
	0x392a9642, 0x3913eb0e, 0x38fd1ca4, 0x38e62b13, 0x38cf1669, 0x38b7deb4, 0x38a08402, 0x38890663, 
	0x387165e3, 0x3859a292, 0x3841bc7f, 0x3829b3b9, 0x3811884d, 0x37f93a4b, 0x37e0c9c3, 0x37c836c2, 
	0x37af8159, 0x3796a996, 0x377daf89, 0x37649341, 0x374b54ce, 0x3731f440, 0x371871a5, 0x36fecd0e, 
	0x36e5068a, 0x36cb1e2a, 0x36b113fd, 0x3696e814, 0x367c9a7e, 0x36622b4c, 0x36479a8e, 0x362ce855, 
	0x361214b0, 0x35f71fb1, 0x35dc0968, 0x35c0d1e7, 0x35a5793c, 0x3589ff7a, 0x356e64b2, 0x3552a8f4, 
	0x3536cc52, 0x351acedd, 0x34feb0a5, 0x34e271bd, 0x34c61236, 0x34a99221, 0x348cf190, 0x34703095, 
	0x34534f41, 0x34364da6, 0x34192bd5, 0x33fbe9e2, 0x33de87de, 0x33c105db, 0x33a363ec, 0x3385a222, 
	0x3367c090, 0x3349bf48, 0x332b9e5e, 0x330d5de3, 0x32eefdea, 0x32d07e85, 0x32b1dfc9, 0x329321c7, 
	0x32744493, 0x32554840, 0x32362ce0, 0x3216f287, 0x31f79948, 0x31d82137, 0x31b88a66, 0x3198d4ea, 
	0x317900d6, 0x31590e3e, 0x3138fd35, 0x3118cdcf, 0x30f8801f, 0x30d8143b, 0x30b78a36, 0x3096e223, 
	0x30761c18, 0x30553828, 0x30343667, 0x301316eb, 0x2ff1d9c7, 0x2fd07f0f, 0x2faf06da, 0x2f8d713a, 
	0x2f6bbe45, 0x2f49ee0f, 0x2f2800af, 0x2f05f637, 0x2ee3cebe, 0x2ec18a58, 0x2e9f291b, 0x2e7cab1c, 
	0x2e5a1070, 0x2e37592c, 0x2e148566, 0x2df19534, 0x2dce88aa, 0x2dab5fdf, 0x2d881ae8, 0x2d64b9da, 
	0x2d413ccd, 0x2d1da3d5, 0x2cf9ef09, 0x2cd61e7f, 0x2cb2324c, 0x2c8e2a87, 0x2c6a0746, 0x2c45c8a0, 
	0x2c216eaa, 0x2bfcf97c, 0x2bd8692b, 0x2bb3bdce, 0x2b8ef77d, 0x2b6a164d, 0x2b451a55, 0x2b2003ac, 
	0x2afad269, 0x2ad586a3, 0x2ab02071, 0x2a8a9fea, 0x2a650525, 0x2a3f503a, 0x2a19813f, 0x29f3984c, 
	0x29cd9578, 0x29a778db, 0x2981428c, 0x295af2a3, 0x29348937, 0x290e0661, 0x28e76a37, 0x28c0b4d2, 
	0x2899e64a, 0x2872feb6, 0x284bfe2f, 0x2824e4cc, 0x27fdb2a7, 0x27d667d5, 0x27af0472, 0x27878893, 
	0x275ff452, 0x273847c8, 0x2710830c, 0x26e8a637, 0x26c0b162, 0x2698a4a6, 0x2670801a, 0x264843d9, 
	0x261feffa, 0x25f78497, 0x25cf01c8, 0x25a667a7, 0x257db64c, 0x2554edd1, 0x252c0e4f, 0x250317df, 
	0x24da0a9a, 0x24b0e699, 0x2487abf7, 0x245e5acc, 0x2434f332, 0x240b7543, 0x23e1e117, 0x23b836ca, 
	0x238e7673, 0x2364a02e, 0x233ab414, 0x2310b23e, 0x22e69ac8, 0x22bc6dca, 0x22922b5e, 0x2267d3a0, 
	0x223d66a8, 0x2212e492, 0x21e84d76, 0x21bda171, 0x2192e09b, 0x21680b0f, 0x213d20e8, 0x21122240, 
	0x20e70f32, 0x20bbe7d8, 0x2090ac4d, 0x20655cac, 0x2039f90f, 0x200e8190, 0x1fe2f64c, 0x1fb7575c, 
	0x1f8ba4dc, 0x1f5fdee6, 0x1f340596, 0x1f081907, 0x1edc1953, 0x1eb00696, 0x1e83e0eb, 0x1e57a86d, 
	0x1e2b5d38, 0x1dfeff67, 0x1dd28f15, 0x1da60c5d, 0x1d79775c, 0x1d4cd02c, 0x1d2016e9, 0x1cf34baf, 
	0x1cc66e99, 0x1c997fc4, 0x1c6c7f4a, 0x1c3f6d47, 0x1c1249d8, 0x1be51518, 0x1bb7cf23, 0x1b8a7815, 
	0x1b5d100a, 0x1b2f971e, 0x1b020d6c, 0x1ad47312, 0x1aa6c82b, 0x1a790cd4, 0x1a4b4128, 0x1a1d6544, 
	0x19ef7944, 0x19c17d44, 0x19937161, 0x196555b8, 0x19372a64, 0x1908ef82, 0x18daa52f, 0x18ac4b87, 
	0x187de2a7, 0x184f6aab, 0x1820e3b0, 0x17f24dd3, 0x17c3a931, 0x1794f5e6, 0x1766340f, 0x173763c9, 
	0x17088531, 0x16d99864, 0x16aa9d7e, 0x167b949d, 0x164c7ddd, 0x161d595d, 0x15ee2738, 0x15bee78c, 
	0x158f9a76, 0x15604013, 0x1530d881, 0x150163dc, 0x14d1e242, 0x14a253d1, 0x1472b8a5, 0x144310dd, 
	0x14135c94, 0x13e39be9, 0x13b3cefa, 0x1383f5e3, 0x135410c3, 0x13241fb6, 0x12f422db, 0x12c41a4f, 
	0x1294062f, 0x1263e699, 0x1233bbac, 0x12038584, 0x11d3443f, 0x11a2f7fc, 0x1172a0d7, 0x11423ef0, 
	0x1111d263, 0x10e15b4e, 0x10b0d9d0, 0x10804e06, 0x104fb80e, 0x101f1807, 0x0fee6e0d, 0x0fbdba40, 
	0x0f8cfcbe, 0x0f5c35a3, 0x0f2b650f, 0x0efa8b20, 0x0ec9a7f3, 0x0e98bba7, 0x0e67c65a, 0x0e36c82a, 
	0x0e05c135, 0x0dd4b19a, 0x0da39978, 0x0d7278eb, 0x0d415013, 0x0d101f0e, 0x0cdee5f9, 0x0cada4f5, 
	0x0c7c5c1e, 0x0c4b0b94, 0x0c19b374, 0x0be853de, 0x0bb6ecef, 0x0b857ec7, 0x0b540982, 0x0b228d42, 
	0x0af10a22, 0x0abf8043, 0x0a8defc3, 0x0a5c58c0, 0x0a2abb59, 0x09f917ac, 0x09c76dd8, 0x0995bdfd, 
	0x09640837, 0x09324ca7, 0x09008b6a, 0x08cec4a0, 0x089cf867, 0x086b26de, 0x08395024, 0x08077457, 
	0x07d59396, 0x07a3adff, 0x0771c3b3, 0x073fd4cf, 0x070de172, 0x06dbe9bb, 0x06a9edc9, 0x0677edbb, 
	0x0645e9af, 0x0613e1c5, 0x05e1d61b, 0x05afc6d0, 0x057db403, 0x054b9dd3, 0x0519845e, 0x04e767c5, 
	0x04b54825, 0x0483259d, 0x0451004d, 0x041ed854, 0x03ecadcf, 0x03ba80df, 0x038851a2, 0x03562038, 
	0x0323ecbe, 0x02f1b755, 0x02bf801a, 0x028d472e, 0x025b0caf, 0x0228d0bb, 0x01f69373, 0x01c454f5, 
	0x0192155f, 0x015fd4d2, 0x012d936c, 0x00fb514b, 0x00c90e90, 0x0096cb58, 0x006487c4, 0x003243f1
};


//	tmp=2.0*M_PI/(127-1);		
//	for(i=0; i<127; i++)
//	{
//		tmpValue1 =	(0.54-0.46*cos(tmp*i)) * (1 << 30) + 0.5;
//	}
const int HammTab[127] = {
	0x051eb852, 0x052816b1, 0x05442bd7, 0x0572e5e6, 0x05b4271f, 0x0607c5fb, 0x066d8d40, 0x06e53c29, 
	0x076e8688, 0x080914fd, 0x08b48528, 0x097069ee, 0x0a3c4bb9, 0x0b17a8c4, 0x0c01f573, 0x0cfa9ca6, 
	0x0e01001c, 0x0f1478d6, 0x1034577f, 0x115fe4e0, 0x12966253, 0x13d70a3a, 0x15211080, 0x1673a319, 
	0x17cdea89, 0x192f0a6c, 0x1a962201, 0x1c024cbd, 0x1d72a2d9, 0x1ee639e7, 0x205c2567, 0x21d3775d, 
	0x234b40e9, 0x24c292df, 0x26387e5f, 0x27ac156d, 0x291c6b8a, 0x2a889646, 0x2befaddb, 0x2d50cdbd, 
	0x2eab152e, 0x2ffda7c7, 0x3147ae0e, 0x328855f5, 0x33bed368, 0x34ea60ca, 0x360a3f73, 0x371db82d, 
	0x38241ba4, 0x391cc2d7, 0x3a070f87, 0x3ae26c93, 0x3bae4e5d, 0x3c6a3324, 0x3d15a350, 0x3db031c5, 
	0x3e397c25, 0x3eb12b0e, 0x3f16f254, 0x3f6a9130, 0x3fabd26a, 0x3fda8c79, 0x3ff6a1a0, 0x40000000, 
	0x3ff6a1a2, 0x3fda8c7c, 0x3fabd26e, 0x3f6a9135, 0x3f16f25a, 0x3eb12b15, 0x3e397c2d, 0x3db031cf, 
	0x3d15a35a, 0x3c6a332f, 0x3bae4e6a, 0x3ae26ca0, 0x3a070f95, 0x391cc2e7, 0x38241bb4, 0x371db83e, 
	0x360a3f85, 0x34ea60dd, 0x33bed37c, 0x32885609, 0x3147ae22, 0x2ffda7dd, 0x2eab1543, 0x2d50cdd4, 
	0x2befadf2, 0x2a88965d, 0x291c6ba1, 0x27ac1585, 0x26387e77, 0x24c292f7, 0x234b4101, 0x21d37775, 
	0x205c257f, 0x1ee639ff, 0x1d72a2f0, 0x1c024cd4, 0x1a962218, 0x192f0a82, 0x17cdeaa0, 0x1673a32f, 
	0x15211095, 0x13d70a4f, 0x12966267, 0x115fe4f4, 0x10345792, 0x0f1478e8, 0x0e01002e, 0x0cfa9cb7, 
	0x0c01f582, 0x0b17a8d2, 0x0a3c4bc6, 0x097069fb, 0x08b48534, 0x08091507, 0x076e8691, 0x06e53c31, 
	0x066d8d47, 0x0607c601, 0x05b42724, 0x0572e5ea, 0x05442bda, 0x052816b2, 0x051eb852
};

#if 0
const int ChanMapTab[8][8] = {
	{ 0,  8, -1, -1, -1, -1, -1, -1},
	{ 1,  0, -1, -1, -1, -1, -1, -1},
	{ 2,  9,  0, -1, -1, -1, -1, -1},
	{ 3, 10, -1,  0, -1, -1, -1, -1},
	{ 4, 11, -1, -1,  0, -1, -1, -1},
	{ 5, 12, -1, -1, -1,  0, -1, -1},
	{ 6, 13, -1, -1, -1, -1,  0, -1},
	{ 7, 14, -1, -1, -1, -1, -1,  0}
};

const VO_AUDIO_CHANNELTYPE ChanIndex[10] = {
	VO_CHANNEL_FRONT_LEFT,
	VO_CHANNEL_FRONT_RIGHT,
	VO_CHANNEL_CENTER,		
	VO_CHANNEL_SIDE_LEFT , 
	VO_CHANNEL_SIDE_RIGHT,	
	VO_CHANNEL_BACK_LEFT,	
	VO_CHANNEL_BACK_RIGHT,	
	VO_CHANNEL_BACK_CENTER,
	VO_CHANNEL_LFE_BASS,
	0
};
#endif


int InitResample(ResInfo *pRes)
{
	int FilterLen, FilterIndex;
	int scale=0, n, k;

	pRes->Scale = (pRes->OutRate/100)*(1 << 20)/(pRes->InRate/100);
	pRes->inv_Scale = (pRes->InRate/100)*(1 << 20)/(pRes->OutRate/100);
		
	if(pRes->OutRate > pRes->InRate)
	{
		scale = pRes->inv_Scale;
		pRes->RateUp2Down = 1;

		if(pRes->level == VO_RESAMPLE_LOW_LEVEL)
			pRes->Interpolation = LinerInterpolation;
//		else if(pRes->level == VO_RESAMPLE_NORMAL_LEVEL)
//			pRes->Interpolation = CosInterpolation;
		n = pRes->OutRate / pRes->InRate;
		if(pRes->OutRate == pRes->InRate * n)
		{
			if(n == 2)
				pRes->RateUp2Down = 2;
			else
			{
				pRes->RateUp2Down = 3;
				pRes->UpMulti = n;
				for(k=0; k<n; k++)
				{
					pRes->UpInterScale[k] = (MUL_10(scale, k) & 1023);
				}
			}
		}
	}
	else if(pRes->OutRate < pRes->InRate)
	{
		scale = pRes->Scale;
		pRes->RateUp2Down = -1;
	}
	else
	{
		pRes->RateUp2Down = 0;
	}

	if(scale <= 0x40000)
	{
		FilterIndex = 0;
	}
	else if(scale <= 0x80000 && scale > 0x40000)
	{
		FilterIndex = 1; 
	}
	else if(scale <= 0xc0000 && scale > 0x80000)
	{
		FilterIndex = 2;
	}
	else
	{
		FilterIndex = 3; 
	}

	FilterLen = FilterLength[FilterIndex + pRes->level*4];
	
	pRes->Filtlen = FilterLen;
	InitFilter(pRes->filter, FilterLen, scale);

	if(pRes->ChanSel == 0xFFFF)
	{
		if(pRes->ChanOut == pRes->ChanIn)
			pRes->ChanUpDown = 0;
		else 
		{
			pRes->ChanUpDown = 1;
			InitChanDnUpMix(pRes);
		}
	}
	else
	{
		int count;
		count = 0;
		for	(n = 0; n < 16; n++)
		{
			if(pRes->ChanSel & (1 << n))
				count++;
		}

		pRes->ChanOut = count;
		pRes->ChanUpDown = -2;
		if(count > pRes->ChanIn)
		{
			pRes->ChanSel = 0xFFFF;
			pRes->ChanUpDown = 1;
		}
	}

	if(pRes->ChanUpDown == 0)
	{
		pRes->filter->nRemain = FilterLen/2*pRes->ChanIn;
	}
	else
	{
		pRes->filter->nRemain = FilterLen/2*pRes->ChanOut;
	}

	pRes->lastpos = 0;
	pRes->UplastScale = 1024;
	
	for(n =0; n < MAX_CHANNEL; n++)
	{
		for(k=0; k<3; k++)
			pRes->UplastSimple[n][k] = 0;
	}

#if 0
	pRes->ChanIndex = ChanMapTab[pRes->ChanIn - 1][pRes->ChanOut -1];

	
	if(pRes->ChanMapSet == 0)
	{
		//set default channel mapping
		switch (pRes->ChanIn)
		{
		case 0:
		case 1:
			//pRes->ChanMap[0] = VO_CHANNEL_CENTER;
		case 2:
			pRes->ChanMap[0] = VO_CHANNEL_FRONT_LEFT;
			pRes->ChanMap[1] = VO_CHANNEL_FRONT_RIGHT;
			break;
		case 3:
			pRes->ChanMap[0] = VO_CHANNEL_FRONT_LEFT;
			pRes->ChanMap[1] = VO_CHANNEL_CENTER;
			pRes->ChanMap[2] = VO_CHANNEL_FRONT_RIGHT;
			break;
		case 4:
			pRes->ChanMap[0] = VO_CHANNEL_FRONT_LEFT;
			pRes->ChanMap[1] = VO_CHANNEL_CENTER;
			pRes->ChanMap[2] = VO_CHANNEL_FRONT_RIGHT;
			pRes->ChanMap[3] = VO_CHANNEL_BACK_CENTER;
			break;
		case 5:
			pRes->ChanMap[0] = VO_CHANNEL_FRONT_LEFT;
			pRes->ChanMap[1] = VO_CHANNEL_CENTER;
			pRes->ChanMap[2] = VO_CHANNEL_FRONT_RIGHT; 
			pRes->ChanMap[3] = VO_CHANNEL_BACK_LEFT;
			pRes->ChanMap[4] = VO_CHANNEL_BACK_RIGHT;
			break;
		case 6:
			pRes->ChanMap[0] = VO_CHANNEL_FRONT_LEFT;
			pRes->ChanMap[1] = VO_CHANNEL_CENTER;
			pRes->ChanMap[2] = VO_CHANNEL_FRONT_RIGHT;
			pRes->ChanMap[3] = VO_CHANNEL_BACK_LEFT;
			pRes->ChanMap[4] = VO_CHANNEL_BACK_RIGHT;
			pRes->ChanMap[5] = VO_CHANNEL_LFE_BASS;
			break;
		case 8:
			pRes->ChanMap[0] = VO_CHANNEL_FRONT_LEFT;
			pRes->ChanMap[1] = VO_CHANNEL_CENTER;
			pRes->ChanMap[2] = VO_CHANNEL_FRONT_RIGHT;
			pRes->ChanMap[3] = VO_CHANNEL_SIDE_LEFT;
			pRes->ChanMap[4] = VO_CHANNEL_SIDE_RIGHT;
			pRes->ChanMap[5] = VO_CHANNEL_BACK_LEFT;
			pRes->ChanMap[6] = VO_CHANNEL_BACK_RIGHT;
			pRes->ChanMap[7] = VO_CHANNEL_LFE_BASS;
			break;
		}
	}



//	for(n=0; n < MAX_CHANNEL; n++)
//	{
//		for(ch = 0; ch < 10; ch++)
//		{
//			if(pRes->ChanMap[ch] == ChanIndex[n])
//				break;
//		}
//		pRes->ChanPos[n] = ch;
//	}
#endif
	return 0;
}

int ResampleCore(ResInfo *pRes, short* outbuffer)
{
//	VO_MEM_OPERATOR *pvoMemop;
	short *inbuffer;
	int inlength, outlength = 0;
	int InStride, outStride;

//	pvoMemop = pRes->pvoMemop;
	InStride = pRes->ChanIn;
	outStride = pRes->ChanOut;
	inbuffer = pRes->input;
	inlength = pRes->inlen/InStride;

	if(pRes->RateUp2Down == 0 && pRes->ChanUpDown == 0)
	{
//		pvoMemop->Copy(VO_INDEX_RESAMPLE, outbuffer, inbuffer, inlength*InStride*sizeof(short));
		voRESMemcpy(outbuffer, inbuffer, inlength*InStride*sizeof(short));
		return inlength;
	}
	
	if(pRes->ChanUpDown != 0)
	{
		if(pRes->RateUp2Down == 0)
		{
			ChannelDownMixType(pRes, (VO_U8 *)inbuffer, inlength, (VO_U8 *)outbuffer);
			return inlength;
		}
		else
		{
			ChannelDownMixType(pRes, (VO_U8 *)inbuffer, inlength, (VO_U8 *)inbuffer);
			InStride = pRes->ChanOut;
		}
	}

#if 0
	if(pRes->RateUp2Down == 0)
	{
		toutbuffer = outbuffer;
	}
	else
	{
		toutbuffer = inbuffer;
	}

	if(pRes->ChanUpDown == -1)
	{
		inlength = ChanCore(pRes, inbuffer, inlength, toutbuffer);
		InStride = pRes->ChanOut;
	}
	else if(pRes->ChanUpDown == 1)
	{
		
		if(pRes->RateUp2Down) {
			if(pRes->tmplen1 < (inlength + MAXFILLEN)*outStride)
			{
				mem_free(pvoMemop, pRes->tmpbuf1);

				pRes->tmplen1 = (inlength + MAXFILLEN)*outStride;
				pRes->tmpbuf1 = mem_malloc(pvoMemop, pRes->tmplen1*sizeof(short), 32);

				if(pRes->tmpbuf1 == NULL)
				{
					return -1;
				}
			}

			toutbuffer = pRes->tmpbuf1;
		}
		
		inlength = ChanCore(pRes, inbuffer, inlength, toutbuffer);
		InStride = pRes->ChanOut;
	}
	else if(pRes->ChanUpDown == -2)
	{
		if(pRes->RateUp2Down == 0)
		{
			inlength = ChanCore(pRes, inbuffer, inlength, toutbuffer);
			InStride = pRes->ChanOut;
		}
	}
#endif

	if(pRes->RateUp2Down != 0)
	{
		outlength = RateCore(pRes, inbuffer, inlength, InStride, outbuffer);
	}

	return outlength;
}

